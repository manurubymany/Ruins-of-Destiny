<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Second Chance: Ruins of Destiny</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: 'Georgia', serif; 
            overflow: hidden; 
            background: #000;
            position: fixed;
            width: 100%;
            height: 100vh;
            touch-action: none;
        }

        #game-container { 
            position: relative; 
            width: 100vw; 
            height: 100vh; 
            overflow: hidden; 
        }

        #bg-layer { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-size: cover; 
            background-position: center center; 
            background-repeat: no-repeat;
            transition: opacity 0.8s ease;
        }
        
        /* OtimizaÃ§Ã£o para fundos em mobile */
        @media (max-width: 768px) {
            #bg-layer {
                background-size: cover;
                background-position: center 30%;
            }
        }

        #char-layer { 
            position: absolute; 
            bottom: 0; 
            left: 0;
            right: 0;
            width: 100%; 
            height: 70vh; 
            display: flex; 
            align-items: flex-end; 
            justify-content: center; 
            pointer-events: none;
            overflow: hidden;
        }

        #char-layer img { 
            height: 100%;
            width: auto;
            max-width: none;
            object-fit: cover;
            object-position: center bottom;
            opacity: 0; 
            transition: opacity 0.5s ease;
        }
        
        /* Ajuste para personagens que ficam muito largos */
        @media (max-width: 480px) {
            #char-layer img {
                width: 100%;
                height: auto;
                max-height: 70vh;
                object-fit: contain;
            }
        }

        #char-layer img.show { opacity: 1; }

        /* === TELA DE LOGIN MOBILE === */
        #login-screen { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-image: url('assets/bg/fundo menu.jpg'); 
            background-size: cover; 
            background-position: center;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            z-index: 1000;
            overflow: hidden;
        }

        #login-screen::before { 
            content: ''; 
            position: absolute; 
            width: 100%; 
            height: 100%; 
            background: radial-gradient(circle at top, rgba(230,199,122,0.3), rgba(90,70,50,0.5));
            animation: particles 8s infinite;
        }

        @keyframes particles { 
            0%, 100% { opacity: 0.3; } 
            50% { opacity: 0.6; } 
        }

        .login-box { 
            background: rgba(250,246,238,0.95); 
            border: 3px solid #E6C77A; 
            border-radius: 20px; 
            padding: 30px 25px; 
            box-shadow: 0 10px 40px rgba(230,199,122,0.5);
            text-align: center; 
            position: relative; 
            z-index: 2;
            width: 85%;
            max-width: 400px;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn { 
            from { opacity: 0; transform: scale(0.9); } 
            to { opacity: 1; transform: scale(1); } 
        }

        .login-box h1 { 
            font-size: 28px; 
            color: #5A4632; 
            margin-bottom: 10px; 
            text-shadow: 2px 2px 4px rgba(230,199,122,0.3);
            line-height: 1.2;
        }

        .login-box p { 
            font-size: 14px; 
            color: #8B7355; 
            margin-bottom: 20px; 
        }

        .login-box input { 
            width: 100%; 
            padding: 12px 15px; 
            font-size: 16px; 
            border: 2px solid #E6C77A; 
            border-radius: 12px; 
            background: #FAF6EE; 
            color: #5A4632; 
            margin-bottom: 20px;
        }

        .login-box input:focus { 
            outline: none; 
            border-color: #D4AF37; 
            box-shadow: 0 0 15px rgba(230,199,122,0.5);
        }

        .start-btn { 
            width: 100%; 
            padding: 14px; 
            font-size: 18px; 
            font-weight: bold; 
            color: #5A4632; 
            background: linear-gradient(135deg, #F3E5B5, #E6C77A); 
            border: 2px solid #E6C77A; 
            border-radius: 12px; 
            cursor: pointer;
            touch-action: manipulation;
        }

        .start-btn:active { 
            transform: scale(0.97); 
            box-shadow: 0 8px 20px rgba(230,199,122,0.6);
        }

        /* === CAIXA DE TEXTO MOBILE === */
        #ui-box { 
            position: fixed; 
            bottom: 0; 
            left: 0;
            right: 0;
            width: 100%;
            background: rgba(250,246,238,0.98); 
            border-top: 3px solid #E6C77A;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            padding: 20px 20px 25px 20px;
            box-shadow: 0 -8px 30px rgba(0,0,0,0.4);
            display: none;
            max-height: 35vh;
            overflow: hidden;
            z-index: 100;
        }

        #name-tag { 
            font-size: 18px; 
            font-weight: bold; 
            color: #5A4632; 
            margin-bottom: 10px; 
            text-shadow: 1px 1px 2px rgba(230,199,122,0.4);
        }

        #text-content { 
            font-size: 15px; 
            line-height: 1.6; 
            color: #5A4632; 
            margin-bottom: 15px;
            max-height: 18vh;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        /* Melhor legibilidade em telas pequenas */
        @media (max-height: 700px) {
            #text-content {
                font-size: 14px;
                line-height: 1.5;
                max-height: 15vh;
            }
        }

        #next-btn { 
            float: right; 
            padding: 10px 20px; 
            font-size: 15px; 
            color: #5A4632; 
            background: linear-gradient(135deg, #F3E5B5, #E6C77A); 
            border: 2px solid #E6C77A; 
            border-radius: 10px; 
            cursor: pointer;
            touch-action: manipulation;
        }

        #next-btn:active { 
            transform: scale(0.95);
        }

        /* === ESCOLHAS MOBILE === */
        #choices-overlay { 
            position: fixed; 
            bottom: 15px; 
            left: 5%;
            right: 5%;
            width: 90%;
            display: none; 
            flex-direction: column; 
            gap: 12px;
            max-height: 60vh;
            overflow-y: auto;
            padding-bottom: 10px;
            z-index: 200;
        }

        .choice-btn { 
            background: rgba(250,246,238,0.98); 
            border: 3px solid #E6C77A; 
            border-radius: 15px; 
            padding: 18px 20px; 
            font-size: 16px; 
            line-height: 1.4;
            color: #5A4632; 
            cursor: pointer; 
            text-align: center;
            touch-action: manipulation;
            box-shadow: 0 4px 15px rgba(230,199,122,0.3);
            transition: all 0.2s ease;
        }

        .choice-btn:active { 
            background: linear-gradient(135deg, #F3E5B5, #E6C77A);
            transform: scale(0.98);
        }

        .choice-btn.premium {
            border-color: #D4AF37;
            background: linear-gradient(135deg, rgba(243,229,181,0.97), rgba(230,199,122,0.97));
        }

        .choice-btn.premium::before {
            content: 'ðŸ’Ž ';
        }

        /* Scrollbar customizada */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(230,199,122,0.2); }
        ::-webkit-scrollbar-thumb { background: #E6C77A; border-radius: 3px; }
    </style>
</head>
<body>
    <audio id="audio-engine" loop></audio>

    <div id="game-container">
        <div id="bg-layer"></div>
        <div id="char-layer"></div>
        
        <div id="ui-box">
            <div id="name-tag"></div>
            <div id="text-content"></div>
            <button id="next-btn" onclick="next()">PrÃ³ximo â–¶</button>
        </div>
        
        <div id="choices-overlay"></div>
    </div>

    <div id="login-screen">
        <div class="login-box">
            <h1>âœ¨ Second Chance âœ¨</h1>
            <p>Ruins of Destiny</p>
            <input type="text" id="player-name" placeholder="Digite seu nome..." maxlength="20">
            <button class="start-btn" onclick="startGame()">ComeÃ§ar Aventura</button>
        </div>
    </div>
    

    <script>
        let step = "prologo_1";
        let nomeJogadora = "Protagonista";
        const audioEngine = document.getElementById('audio-engine');
        audioEngine.volume = 0.4;

        const gameData = {
            // === PRÃ“LOGO ===
            "prologo_1": { 
                bg: "o escritÃ³rio", 
                audio: "escritÃ³rio", 
                name: "[NOME]", 
                text: "(Pensamento) Outro dia de relatÃ³rios, prazos e vozes que nunca parecem me ouvir. Sinto como se estivesse apenas flutuando pela vida, sem rumo.", 
                next: "prologo_2" 
            },
            "prologo_2": { 
                bg: "o escritÃ³rio", 
                audio: "escritÃ³rio", 
                name: "[NOME]", 
                text: "(Olho para o relÃ³gio digital que marca 18:00) 'Finalmente 18h... que dia cansativo. Estou exausta. Acho que vou apenas para casa e tentar esquecer que amanhÃ£ tudo recomeÃ§a.'", 
                next: "prologo_acidente" 
            },
            "prologo_acidente": { 
                bg: "Noite", 
                audio: "o acidente",
                impacto: true,
                name: "Sistema", 
                text: "(SFX: Pneus derrapando, som de batida de carro e vidro se estilhaÃ§ando) 'O que...? Tudo ficou escuro... NÃ£o sinto o chÃ£o... nÃ£o sinto nada.'", 
                next: "prologo_vazio" 
            },
            "prologo_vazio": { 
                bg: "O Vazio", 
                audio: "menu", 
                name: "Voz de Aleia", 
                text: "'Sua chama ainda nÃ£o se apagou totalmente, alma perdida. O destino cometeu um erro... ou talvez, tenha criado uma oportunidade.'", 
                next: "prologo_vazio_2" 
            },
            "prologo_vazio_2": { 
                bg: "O Vazio", 
                audio: "menu",
                name: "[NOME]", 
                text: "'Quem Ã© vocÃª? Eu estou... morta?'", 
                next: "prologo_vazio_3"
            },
            "prologo_vazio_3": { 
                bg: "O Vazio",
                name: "Voz de Aleia", 
                text: "'VocÃª estÃ¡ no limiar. Mas eu vejo em vocÃª um desejo de mudanÃ§a que nunca foi atendido. [NOME], esta Ã© sua segunda chance. Use-a bem.'", 
                next: "prologo_despertar"
            },
            "prologo_despertar": {
                bg: "Ruinas",
                audio: "mystical japanese",
                name: "[NOME]",
                text: "(Acordo na grama macia, respirando fundo) 'Onde... onde eu estou? O cheiro de poluiÃ§Ã£o sumiu... o ar Ã© tÃ£o puro que chega a doer.'",
                next: "prologo_escolha"
            },
            "prologo_escolha": {
                bg: "anoitecendo",
                name: "[NOME]",
                text: "(Vejo quatro caminhos diferentes Ã  minha frente) 'Aquela voz disse segunda chance... Se for verdade, eu nÃ£o vou desperdiÃ§Ã¡-la. Ã‰ hora de descobrir quem eu realmente sou.'",
                next: "bifurcacao"
            },

            // === BIFURCAÃ‡ÃƒO ===
            "bifurcacao": {
                bg: "a escolha", 
                audio: "mystical japanese",
                name: "Sistema", 
                text: "Quatro caminhos se abrem diante de vocÃª. Qual deles chama sua alma?", 
                choices: [
                    { text: "ðŸŒ¸ Seguir o Rio", next: "desc_kaiden" },
                    { text: "ðŸŒ™ Descansar na Ãrvore", next: "desc_lucien" },
                    { text: "âš”ï¸ Voltar para as RuÃ­nas", next: "desc_aelion" },
                    { text: "â˜€ï¸ Seguir pela Floresta", next: "desc_eryon" }
                ]
            },

            // === DESCRIÃ‡Ã•ES DAS ROTAS ===
            "desc_kaiden": {
                bg: "O Caminho do Templo",
                audio: "mystical japanese", 
                name: "[NOME]",
                text: "(Pensamento) Que lugar estranho... parece abandonado, mas sinto como se mil olhos estivessem me vigiando entre as Ã¡rvores.",
                choices: [
                    { text: "Seguir o rio", next: "k_1" }, 
                    { text: "Voltar", next: "bifurcacao" }
                ]
            },
            "desc_lucien": {
                bg: "A arvore",
                audio: "gÃ³tica do lucien", 
                name: "[NOME]",
                text: "(Pensamento) Que frio... Minha cabeÃ§a ainda dÃ³i. Onde eu estou? Isso nÃ£o parece mais a floresta de onde eu saÃ­...",
                choices: [
                    { text: "Explorar a Ã¡rvore", next: "l_1" }, 
                    { text: "Voltar", next: "bifurcacao" }
                ]
            },
            "desc_aelion": {
                bg: "Ruinas",
                audio: "trilha do aelion", 
                name: "[NOME]",
                text: "(Pensamento) Que lugar majestoso... mas parece tÃ£o solitÃ¡rio. Ã‰ como se a prÃ³pria tristeza estivesse impregnada nessas paredes.",
                choices: [
                    { text: "Entrar nas ruÃ­nas", next: "a_1" }, 
                    { text: "Voltar", next: "bifurcacao" }
                ]
            },
            "desc_eryon": {
                bg: "O Esconderijo",
                audio: "passos na floresta", 
                name: "[NOME]",
                text: "(Pensamento) Que sensaÃ§Ã£o Ã© essa? Sinto como se meu corpo estivesse ficando leve... o medo simplesmente desapareceu aqui.",
                choices: [
                    { text: "Seguir pela floresta", next: "e_1" }, 
                    { text: "Voltar", next: "bifurcacao" }
                ]
            },

            // === ROTA KAIDEN ===
            "k_1": { 
                bg: "O Templo Abandonado", 
                char: "Kaiden preocupado (roupa verde)", 
                audio: "mystical japanese", 
                name: "Kaiden", 
                text: "Espere! NÃ£o dÃª mais nenhum passo! Quem Ã© vocÃª e como conseguiu atravessar a barreira de nÃ©voa? Este templo nÃ£o recebe visitas humanas hÃ¡ mais de um sÃ©culo.",
                choices: [
                    { text: "Pode me ajudar?", next: "k_ajuda" },
                    { text: "Quem Ã© vocÃª?", next: "k_quem" },
                    { text: "ðŸ’Ž VocÃª parece solitÃ¡rio...", next: "k_premium", premium: true }
                ]
            },
            "k_ajuda": {
                char: "Kaiden preocupado (roupa verde)",
                name: "Kaiden",
                text: "Tsc. VocÃªs humanos sÃ£o todos iguais... sempre pedindo antes de oferecer algo. Mas... vocÃª estÃ¡ sangrando no joelho. Venha, entre antes que os demÃ´nios da floresta sintam o cheiro.",
                next: "k_historia"
            },
            "k_quem": {
                char: "Kaiden preocupado (roupa verde)",
                name: "Kaiden",
                text: "Eu sou o guardiÃ£o deste lugar. E o seu pior pesadelo se nÃ£o sair daqui agora. Mas, vendo o seu estado... duvido que consiga andar dois metros sem tropeÃ§ar de novo.",
                next: "k_historia"
            },
            "k_premium": {
                char: "Kaiden triste e chorando (roupa verde)",
                name: "Kaiden",
                text: "(Ele congela, surpreso) 'O quÃª? SolitÃ¡rio? NÃ£o diga asneiras, humana. Eu tenho o silÃªncio e as estrelas.'",
                next: "k_premium_2"
            },
            "k_premium_2": {
                bg: "O Templo",
                char: "Kaiden triste e chorando (roupa verde)",
                name: "Kaiden",
                text: "'A verdade Ã© que... eu nÃ£o falo com ninguÃ©m hÃ¡ sÃ©culos. Este selo me mantÃ©m aqui, enquanto o resto do meu mundo seguiu em frente. Falar com vocÃª... Ã© como ouvir uma mÃºsica que eu jÃ¡ tinha esquecido.'",
                next: "k_historia"
            },
            "k_historia": { 
                bg: "dentro do templo", 
                char: "Kaiden triste e chorando (roupa verde)", 
                name: "Kaiden", 
                text: "VocÃª pergunta por que estou sozinho? (Ele desvia o olhar) Fui amaldiÃ§oado por deuses antigos a proteger este rio sagrado. Se eu sair, minha alma simplesmente desaparece no vazio.", 
                next: "k_parceria" 
            },
            "k_parceria": { 
                bg: "O Templo", 
                char: "Kaiden segurando a rosa em mostrando a calda (roupa vermelha)", 
                name: "Kaiden", 
                text: "VocÃª diz que nÃ£o tem medo da minha maldiÃ§Ã£o? Que criatura peculiar vocÃª Ã©, [NOME]. As flores do templo estÃ£o morrendo. Se vocÃª insiste em ficar, talvez possamos cuidar deste lugar... juntos.", 
                next: "k_perigo" 
            },
            "k_perigo": { 
                bg: "noite e chuva", 
                char: "Kaiden preocupado (roupa verde)", 
                name: "Kaiden", 
                text: "CUIDADO! O rio sentiu sua energia vital e as sombras do esquecimento estÃ£o se revoltando! (Ele desembainha uma lÃ¢mina espiritual) Fique atrÃ¡s de mim, [NOME]!", 
                next: "k_romance" 
            },
            "k_romance": { 
                bg: "O Templo", 
                char: "Kaiden segurando a rosa e sorrindo (roupa vermelha)", 
                name: "Kaiden", 
                text: "Obrigado por nÃ£o ter fugido... (Ele te estende uma rosa vermelha brilhante) Esta flor nasceu da minha magia. Enquanto ela brilhar, significa que meu coraÃ§Ã£o bate por vocÃª.", 
                next: "k_paixao" 
            },
            "k_paixao": { 
                bg: "O Templo", 
                char: "Kaiden com o kimono aberto mostrando o abs tentando me beijar", 
                name: "Kaiden", 
                text: "[NOME]... a eternidade que eu tanto odiava agora parece curta demais se for para passÃ¡-la ao seu lado. Eu nÃ£o quero passar mais nenhuma noite sem sentir o seu calor perto de mim.", 
                next: "k_final" 
            },
            "k_final": { 
                bg: "O Templo", 
                char: "Kaiden oferecendo a mÃ£o (roupa preta)", 
                name: "Kaiden", 
                text: "O destino me deu uma segunda chance ao trazer vocÃª atÃ© aqui. [NOME], vocÃª aceitaria unir sua alma Ã  minha e governar este templo como minha esposa?", 
                choices: [
                    { text: "ðŸ’ Aceitar o Casamento", next: "k_casamento" },
                    { text: "Ficar como Parceira", next: "k_sozinha" }
                ]
            },
            "k_casamento": { 
                bg: "O Templo", 
                char: "Kaiden segurando a alianÃ§a casamento", 
                name: "Kaiden", 
                text: "Com este anel, eu quebro o ciclo da solidÃ£o. Eu te prometo, [NOME], que nem o tempo, nem a morte e nem o esquecimento poderÃ£o nos separar. VocÃª Ã© minha eternidade.", 
                next: "fim" 
            },
            "k_sozinha": { 
                bg: "O Templo", 
                char: "Kaiden preocupado (roupa verde)",
                name: "Kaiden", 
                text: "Eu entendo... sua liberdade Ã© preciosa. Mesmo que nÃ£o nos unamos formalmente, o fato de vocÃª estar aqui, ao meu lado, jÃ¡ Ã© o maior milagre que recebi em sÃ©culos.", 
                next: "fim" 
            },

            // === ROTA LUCIEN ===
            "l_1": { 
                bg: "entrando no portao do castelo", 
                audio: "gÃ³tica do lucien", 
                char: "Lucien como o lord vampiro", 
                name: "Lucien", 
                text: "Humanos raramente sobrevivem a este castelo... O que te faz pensar que serÃ¡s diferente, pequena mortal? O teu sangue canta para mim.", 
                choices: [
                    { text: "NÃ£o tenho medo de ti", next: "l_coragem" },
                    { text: "Estou apenas perdida", next: "l_perdida" },
                    { text: "ðŸ’Ž Seus olhos sÃ£o lindos", next: "l_premium", premium: true }
                ]
            },
            "l_coragem": { 
                char: "Lucien como o lord vampiro",
                name: "Lucien", 
                text: "Audaz... Gosto disso. Talvez a tua alma seja tÃ£o vibrante quanto o teu sangue.", 
                next: "l_historia" 
            },
            "l_perdida": { 
                char: "Lucien como o lord vampiro",
                name: "Lucien", 
                text: "Pois agora foste encontrada pelo destino. Rezas para que ele seja gentil contigo.", 
                next: "l_historia" 
            },
            "l_premium": {
                bg: "Dentro do castelo sombrio",
                char: "Lucien sorrindo sarcastico",
                name: "Lucien",
                text: "(Surpreso) 'Lindos? VocÃª vÃª a cor do sangue e chama de beleza? VocÃª Ã© louca ou estÃ¡ tentando me seduzir para sobreviver?'",
                next: "l_premium_2"
            },
            "l_premium_2": {
                char: "Lucien sorrindo feliz",
                name: "Lucien",
                text: "(Ele te envolve em sua capa) 'Eu deveria drenar cada gota desse seu elogio... Mas hÃ¡ algo em vocÃª que me dÃ¡ vontade de... protegÃª-la do mundo lÃ¡ fora.'",
                next: "l_historia"
            },
            "l_historia": { 
                bg: "Dentro do castelo sombrio", 
                char: "Lucien triste e chorando", 
                name: "Lucien", 
                text: "(LÃ¡grimas de sangue escorrem pelo rosto) A imortalidade Ã© apenas uma solidÃ£o que nunca termina. Vi impÃ©rios caÃ­rem, mas nada dÃ³i tanto quanto o silÃªncio destes sÃ©culos.", 
                next: "l_parceria" 
            },
            "l_parceria": { 
                bg: "Dentro do castelo sombrio", 
                char: "Lucien encarando de lado falando", 
                name: "Lucien", 
                text: "Tu tens coragem, [NOME]. HÃ¡ algo em ti... uma luz que desafia a minha escuridÃ£o. Ã‰ fascinante. Queres ajudar-me a redescobrir o que Ã© ser vivo?", 
                choices: [
                    { text: "Ficarei ao teu lado", next: "l_sim" },
                    { text: "Se nÃ£o me morder", next: "l_brincadeira" }
                ]
            },
            "l_sim": { 
                char: "Lucien sorrindo feliz",
                name: "Lucien", 
                text: "EntÃ£o o pacto estÃ¡ selado. O castelo agora tambÃ©m te pertence.", 
                next: "l_perigo" 
            },
            "l_brincadeira": { 
                char: "Lucien sorrindo sarcastico",
                name: "Lucien", 
                text: "(Ele dÃ¡ um sorriso sombrio) Farei o meu melhor para me controlar...", 
                next: "l_perigo" 
            },
            "l_perigo": { 
                bg: "noite e chuva", 
                char: "Lucien encarando olhar preocupado", 
                name: "Lucien", 
                text: "Cuidado! Os caÃ§adores voltaram por mim... Mas eles cometeram um erro fatal ao ameaÃ§ar-te. NÃ£o deixarei que te toquem, nem que eu tenha de queimar o mundo!", 
                next: "l_romance" 
            },
            "l_romance": { 
                bg: "A torre mais alta", 
                char: "Lucien sorrindo feliz", 
                name: "Lucien", 
                text: "(Ele observa o luar ao teu lado) A noite Ã© eterna, mas contigo... ela tornou-se doce. Nunca pensei que voltaria a apreciar a beleza da lua.", 
                next: "l_paixao" 
            },
            "l_paixao": { 
                bg: "Dentro do castelo sombrio", 
                char: "Lucien sem camisa proximo tentando me beijar", 
                name: "Lucien", 
                text: "[NOME]... sentes o meu coraÃ§Ã£o? Ele bate apenas por ti agora. Sou teu, corpo e alma, se me aceitares.", 
                choices: [
                    { text: "ðŸ’‹ Beijar Lucien", next: "l_final" },
                    { text: "AbraÃ§Ã¡-lo", next: "l_final" }
                ]
            },
            "l_final": { 
                bg: "O Castelo das Sombras", 
                char: "Lucien sorrindo feliz", 
                name: "Lucien", 
                text: "O sol nunca mais brilharÃ¡ da mesma forma sem ti. Queres ser a minha rainha da noite e governar a eternidade ao meu lado?", 
                choices: [
                    { text: "ðŸ’ Casar com Lucien", next: "l_casamento" },
                    { text: "Seguir sozinha", next: "fim" }
                ]
            },
            "l_casamento": { 
                bg: "A torre mais alta", 
                char: "Lucien colocando a alianÃ§a em minha mÃ£o", 
                name: "Lucien", 
                text: "Com este anel, prendo a minha vida Ã  tua. A eternidade agora tem um propÃ³sito real: amar-te.", 
                next: "fim" 
            },

            // === ROTA AELION ===
            "a_1": { 
                bg: "Ruinas", 
                audio: "trilha do aelion", 
                char: "Aelion como rei dos elfos", 
                name: "Aelion", 
                text: "O que uma humana busca num reino em cinzas? Estas pedras guardam memÃ³rias que a tua raÃ§a jÃ¡ esqueceu hÃ¡ muito tempo.", 
                choices: [
                    { text: "Procuro a verdade", next: "a_verdade" },
                    { text: "Admirei a beleza", next: "a_beleza" },
                    { text: "ðŸ’Ž Deixe-me ajudar a restaurar", next: "a_premium", premium: true }
                ]
            },
            "a_verdade": { 
                char: "Aelion como rei dos elfos",
                name: "Aelion", 
                text: "A verdade Ã© um fardo pesado. EstÃ¡s pronta para carregÃ¡-lo?", 
                next: "a_historia" 
            },
            "a_beleza": { 
                char: "Aelion como rei dos elfos",
                name: "Aelion", 
                text: "Beleza... HÃ¡ sÃ©culos que ninguÃ©m via nada alÃ©m de ruÃ­nas aqui.", 
                next: "a_historia" 
            },
            "a_premium": {
                bg: "Ruinas do trono 1",
                char: "Aelion segurando o lirio olhar distante",
                name: "Aelion",
                text: "(Ele segura seu pulso com firmeza) 'NÃ£o toque nisso! Runas de contenÃ§Ã£o podem ser fatais para quem nÃ£o possui sangue nobre.'",
                next: "a_premium_2"
            },
            "a_premium_2": {
                char: "Aelion olhando para traz (roupa branca)",
                name: "Aelion",
                text: "'VocÃª... nÃ£o foi repelida? Estranho. Se realmente quer ajudar, observe. Esta runa significa Eternidade. Ã‰ assim que a verdadeira histÃ³ria Ã© escrita.'",
                next: "a_historia"
            },
            "a_historia": { 
                bg: "Ruinas do trono 1", 
                char: "Aelion segurando o lirio olhar distante", 
                name: "Aelion", 
                text: "O meu povo partiu para as Terras Imortais, e eu fiquei para trÃ¡s com o meu orgulho e o meu dever. Sou o rei de um povo que nÃ£o existe mais.", 
                next: "a_parceria" 
            },
            "a_parceria": { 
                bg: "Ruinas do trono 2", 
                char: "Aelion olhando para traz (roupa branca)", 
                name: "Aelion", 
                text: "Olha... as flores estÃ£o a voltar a brotar entre as fendas do mÃ¡rmore. Ã‰ a tua presenÃ§a, [NOME]? Tu trazes vida a tudo o que tocas.", 
                next: "a_perigo" 
            },
            "a_perigo": { 
                bg: "O Esconderijo", 
                char: "Aelion olhando de lado (roupa preta)", 
                name: "Aelion", 
                text: "O Vazio estÃ¡ a consumir as Ãºltimas runas de proteÃ§Ã£o! Fica atrÃ¡s de mim, [NOME]! Se este for o meu fim, morrerei protegendo a Ãºltima coisa bela que restou neste mundo!", 
                next: "a_romance" 
            },
            "a_romance": { 
                bg: "A arvore", 
                char: "Aelion sorrindo (roupa preta)", 
                name: "Aelion", 
                text: "Sobrevivemos... (Ele sorri, uma expressÃ£o rara e pura) Nunca pensei que voltaria a sorrir assim. A tua luz Ã© mais forte que a magia dos meus ancestrais.", 
                next: "a_paixao" 
            },
            "a_paixao": { 
                bg: "Ruinas do trono 1", 
                char: "Aelion tentando me beijar levemente corado", 
                name: "Aelion", 
                text: "O meu reino pode estar em ruÃ­nas, mas o meu coraÃ§Ã£o estÃ¡ a ser reconstruÃ­do por ti. Deixa-me provar o teu amor, [NOME].", 
                choices: [
                    { text: "ðŸ’‹ Entregar-se ao beijo", next: "a_final" },
                    { text: "Dizer que o amas", next: "a_final" }
                ]
            },
            "a_final": { 
                bg: "A arvore", 
                char: "Aelion sorrindo oferecendo a mÃ£o", 
                name: "Aelion", 
                text: "NÃ£o quero mais ser o rei das cinzas. Quero construir um novo mundo contigo. Governas estas terras ao meu lado?", 
                choices: [
                    { text: "ðŸ’ Casar com Aelion", next: "a_casamento" },
                    { text: "Seguir sozinha", next: "fim" }
                ]
            },
            "a_casamento": { 
                bg: "A arvore", 
                char: "Aelion corpo inteiro casamento", 
                name: "Aelion", 
                text: "O nosso reino renasce hoje sob a luz das estrelas. Seremos eternos nos contos que ainda virÃ£o.", 
                next: "fim" 
            },

            // === ROTA ERYON ===
            "e_1": { 
                bg: "O Esconderijo", 
                audio: "passos na floresta", 
                char: "Eryon Deus da Luz", 
                name: "Eryon", 
                text: "Esperava por ti, pequena estrela. O tecido do tempo me avisou que uma alma vibrante cruzaria o vÃ©u esta noite.", 
                choices: [
                    { text: "Por que me esperava?", next: "e_esperava" },
                    { text: "Onde estou?", next: "e_onde" },
                    { text: "ðŸ’Ž VocÃª parece um anjo", next: "e_premium", premium: true }
                ]
            },
            "e_esperava": { 
                char: "Eryon Deus da Luz",
                name: "Eryon", 
                text: "Porque vocÃª Ã© a peÃ§a que faltava neste mundo em declÃ­nio. Sua luz Ã© pura, algo que eu nÃ£o via hÃ¡ eras.", 
                next: "e_historia" 
            },
            "e_onde": { 
                char: "Eryon Deus da Luz",
                name: "Eryon", 
                text: "VocÃª estÃ¡ no SantuÃ¡rio do Lago Lunar. Um lugar entre o que foi e o que serÃ¡. Aqui, as feridas da alma podem comeÃ§ar a fechar.", 
                next: "e_historia" 
            },
            "e_premium": {
                bg: "eryon_1",
                char: "Eryon envergonhado corado",
                name: "Eryon",
                text: "(Ele cora levemente) 'Um anjo? Sou apenas um mensageiro do que resta da luz. Mas... suas palavras aquecem minha essÃªncia.'",
                next: "e_premium_2"
            },
            "e_premium_2": {
                bg: "eryon_2",
                char: "Eryon serio oferecendo a mÃ£o",
                name: "Eryon",
                text: "(Ele coloca as mÃ£os sobre seus ombros) 'VocÃª se machucou na queda... Deixe-me cuidar disso.' (Uma luz dourada te envolve e toda a dor desaparece)",
                next: "e_historia"
            },
            "e_historia": { 
                bg: "eryon_1", 
                char: "Eryon triste e preocupado", 
                name: "Eryon", 
                text: "Ser um Deus Ã© observar tudo, mas nÃ£o tocar em nada. A luz Ã© vasta, mas sem ninguÃ©m para partilhar o calor, ela Ã© apenas um vazio brilhante e cego.", 
                next: "e_parceria" 
            },
            "e_parceria": { 
                bg: "eryon_2", 
                char: "Eryon serio oferecendo a mÃ£o", 
                name: "Eryon", 
                text: "Vem comigo, [NOME]. Deixa-me mostrar-te os segredos da criaÃ§Ã£o atravÃ©s dos teus olhos mortais. Quero ver o mundo como tu o vÃªs.", 
                next: "e_perigo" 
            },
            "e_perigo": { 
                bg: "eryon_3", 
                char: "Eryon serio", 
                name: "Eryon", 
                text: "A escuridÃ£o primordial tenta apagar a tua luz porque tens o que os deuses invejam: um coraÃ§Ã£o puro. NÃ£o permitirei que te levem de mim!", 
                next: "e_romance" 
            },
            "e_romance": { 
                bg: "A arvore", 
                char: "Eryon segurando a flor olhar distrante", 
                name: "Eryon", 
                text: "A batalha terminou, mas a minha admiraÃ§Ã£o por ti sÃ³ cresce. A tua alma brilha mais do que qualquer sol que eu jÃ¡ tenha criado.", 
                next: "e_paixao" 
            },
            "e_paixao": { 
                bg: "O Esconderijo", 
                char: "Eryon corado tentando me beijar", 
                name: "Eryon", 
                text: "Sinto que posso desistir da minha divindade apenas para sentir o teu toque por um minuto. Amo-te para alÃ©m do tempo e do espaÃ§o.", 
                choices: [
                    { text: "ðŸ’‹ Aceitar o amor de um Deus", next: "e_final" },
                    { text: "Prometer nunca o deixar", next: "e_final" }
                ]
            },
            "e_final": { 
                bg: "A arvore", 
                char: "Eryon sorrindo com a mÃ£o de tras da cabeÃ§a", 
                name: "Eryon", 
                text: "O cÃ©u pode esperar. Quero viver aqui, agora, contigo. Ficas comigo para toda a eternidade?", 
                choices: [
                    { text: "ðŸ’ Casar com Eryon", next: "e_casamento" },
                    { text: "Seguir sozinha", next: "fim" }
                ]
            },
            "e_casamento": { 
                bg: "A arvore", 
                char: "Eryon sorrindo casamento", 
                name: "Eryon", 
                text: "Agora Ã©s a minha luz, o meu sol e a minha lua. O universo inteiro celebra o nosso amor hoje.", 
                next: "fim" 
            },
            
            "fim": { 
                bg: "fundo menu", 
                name: "Sistema", 
                text: "Obrigado por jogar Second Chance: Ruins of Destiny! â¤ï¸âœ¨", 
                next: "restart" 
            }
        };

        function transitionAudio(trackName, extension = "mp4", forceImpact = false) {
            const newSrc = `assets/audio/${trackName}.${extension}`;
            if (audioEngine.src.includes(newSrc)) return;

            if (forceImpact) {
                audioEngine.pause();
                audioEngine.src = newSrc;
                audioEngine.loop = false;
                audioEngine.volume = 1.0;
                audioEngine.play().catch(e => console.log("Erro Ã¡udio impacto"));
                return;
            }

            let fadeOut = setInterval(() => {
                if (audioEngine.volume > 0.05) {
                    audioEngine.volume -= 0.05;
                } else {
                    clearInterval(fadeOut);
                    audioEngine.pause();
                    audioEngine.src = newSrc;
                    audioEngine.loop = true;
                    audioEngine.play().then(() => {
                        let fadeIn = setInterval(() => {
                            if (audioEngine.volume < 0.4) {
                                audioEngine.volume += 0.05;
                            } else {
                                clearInterval(fadeIn);
                            }
                        }, 50);
                    }).catch(e => console.log("Ãudio bloqueado"));
                }
            }, 30);
        }

        function render() {
            if (step === "restart") { location.reload(); return; }
            const data = gameData[step];
            if (!data) return;

            document.getElementById('bg-layer').style.backgroundImage = `url('assets/bg/${data.bg}.jpg')`;
            
            const charLayer = document.getElementById('char-layer');
            if (data.char) {
                charLayer.style.opacity = "0";
                setTimeout(() => {
                    charLayer.innerHTML = `<img src="assets/chars/${data.char}.png" class="show">`;
                    charLayer.style.opacity = "1";
                }, 300);
            } else {
                charLayer.innerHTML = "";
            }

            if (data.audio) {
                const isMenu = data.audio === "menu";
                transitionAudio(data.audio, isMenu ? "mpeg" : "mp4", data.impacto || false);
            }

            const choicesOverlay = document.getElementById('choices-overlay');
            const uiBox = document.getElementById('ui-box');

            if (data.choices) {
                uiBox.style.display = 'none';
                choicesOverlay.style.display = 'flex';
                choicesOverlay.innerHTML = "";
                data.choices.forEach(c => {
                    const b = document.createElement('div');
                    b.className = 'choice-btn';
                    if (c.premium) b.classList.add('premium');
                    b.innerText = c.text;
                    b.onclick = () => { 
                        step = c.next; 
                        choicesOverlay.style.display = 'none'; 
                        render(); 
                    };
                    choicesOverlay.appendChild(b);
                });
            } else {
                uiBox.style.display = 'block';
                choicesOverlay.style.display = 'none';
                document.getElementById('name-tag').innerText = data.name.replace("[NOME]", nomeJogadora);
                document.getElementById('text-content').innerText = data.text.replace("[NOME]", nomeJogadora);
            }
        }

        function startGame() {
            const input = document.getElementById('player-name').value;
            if (input.trim() !== "") nomeJogadora = input;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('ui-box').style.display = 'block';
            render();
        }

        function next() {
            const data = gameData[step];
            if (data && data.next && !data.choices) {
                step = data.next;
                render();
            }
        }

        // Prevenir scroll indesejado no mobile
        document.addEventListener('touchmove', function(e) {
            if (e.target.closest('#text-content') || e.target.closest('#choices-overlay')) {
                return;
            }
            e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>